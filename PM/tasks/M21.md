# M21 — Versioning

**Branch:** `feature/m21-versioning`
**Status:** PLANNED
**Depends on:** nothing (ale M23 wymaga M21)

## Overview
Każda iteracja screena = nowy rekord (kopia). Historia wersji w sidebarze. Screen ma status draft/approved. Draft screeny — widoczne na liście bez podglądu. Approved — klikalny z thumbnailem.

## Data Model Changes (addytywne, backward compatible)

```js
// Screen model — nowe pola:
{
  version: 1,             // int, starts at 1
  parent_screen_id: null, // null = oryginał
  status: "draft",        // "draft" | "approved" | "rejected"
  // ...reszta bez zmian
}
// Migration w getProject(): screen.version ??= 1, screen.status ??= "draft", etc.
```

## Tasks

| # | Task | Pliki | Status |
|---|------|-------|--------|
| T1 | Data model + migration fallback | `src/storage/project-store.js` | PLANNED |
| T2 | `createScreenVersion()` method | `src/storage/project-store.js` | PLANNED |
| T3 | MCP tool `mockup_create_screen_version` | `src/mcp/tools/screen-tools.js` | PLANNED |
| T4 | MCP tool `mockup_set_screen_status` | `src/mcp/tools/screen-tools.js` | PLANNED |
| T5 | Sidebar version tree (grouped by root screen) | `src/preview/server.js` | PLANNED |
| T6 | Preview gate (draft = no thumbnail) | `src/preview/server.js` | PLANNED |
| T7 | API `/api/projects` — zwraca version/status | `src/preview/server.js` | PLANNED |
| T8 | Testy | `tests/storage/versioning.test.js` (NEW) | PLANNED |

## Key: createScreenVersion
Klonuje screen (structuredClone), nowy ID, `version++`, `parent_screen_id = source.id`, `status = "draft"`.
Unresolved comments kopiowane do nowej wersji z remapowanymi element_ids (dla M23 integration).
