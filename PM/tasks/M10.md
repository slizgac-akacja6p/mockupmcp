# M10 Tasks — Preview + Performance Bugfixes

## Sprint 1: Bugfix

| # | Task | Size | Status |
|---|------|------|--------|
| 1 | Screenshot shadow fix — body CSS width/height/overflow/margin | S | DONE |
| 2 | Sidebar deduplikacja + scroll state — expandedProjects Set refactor | M | DONE |
| 3 | Tool descriptions — performance guidance hints (4 files) | S | DONE |
| 4 | Code review T1+T2+T3 | S | DONE |

## Details

### T1: Screenshot shadow fix
**File:** `src/renderer/html-builder.js` (L42)
**Problem:** Body had no explicit dimensions → Puppeteer rendered gray area below .screen div (style background bleed).
**Fix:** Added `width: ${screen.width}px; height: ${screen.height}px; overflow: hidden; margin: 0;` to body CSS.
**Test:** New test in `tests/renderer/html-builder.test.js` verifying body dimensions match screen.

### T2: Sidebar dedup + scroll state
**File:** `src/preview/server.js` (SIDEBAR_JS)
**Problem A:** Click handler used `insertAdjacentHTML` without checking for existing screens → duplicates on re-click.
**Problem B:** `loadTree()` 3s polling overwrote `tree.innerHTML` → lost scroll and expand/collapse state.
**Fix:** Added `expandedProjects` Set for persistent expand state, save/restore `sidebar.scrollTop` around innerHTML writes, removed `insertAdjacentHTML` and manual display toggle.

### T3: Tool descriptions
**Files:** `element-tools.js`, `screen-tools.js`, `template-tools.js`, `export-tools.js`
**Fix:** Added performance hints steering Claude toward batch operations (generate_screen, apply_template) over individual add_element calls.

### T4: Code review
**Result:** No critical issues. Two minor fixes applied post-review:
- Added comment documenting body CSS is Puppeteer-only (PREVIEW_STYLE overrides in browser)
- Moved scrollTop read inside fetch callback (closer to innerHTML write)
