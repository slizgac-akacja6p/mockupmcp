# M22 — Comments per-element

**Branch:** `feature/m22-comments`
**Status:** DONE (PR #29)
**Depends on:** nothing (ale M23 intensywnie korzysta z M22)

## Overview
Komentarze przypisane do konkretnych elementów. Widoczne w edytorze jako numerowane piny. Wyświetlane w edytorze i w PNG render (piny + legenda pod screenem). Claude widzi feedback wizualnie i przez MCP resource.

## Data Model (w screen object, nie osobny plik)

```js
comments: [{
  id: "cmt_xxx",
  element_id: "el_yyy",  // null = screen-level
  text: "This button should be blue",
  author: "user",        // "user" | "ai"
  resolved: false,
  pin_number: 1,
  created_at: "2026-02-24T..."
}]
```

## Tasks

| # | Task | Pliki | Status |
|---|------|-------|--------|
| T1 | Storage CRUD | `src/storage/project-store.js` | PLANNED |
| T2 | MCP tools (3) | `src/mcp/tools/comment-tools.js` (NEW) | PLANNED |
| T3 | MCP resource `mockup://projects/{pid}/screens/{sid}/comments` | `src/mcp/resources.js` | PLANNED |
| T4 | REST API | `src/preview/server.js` | PLANNED |
| T5 | Editor: piny na canvasie + panel | `src/preview/editor/comments.js` (NEW) | PLANNED |
| T6 | PNG render: piny + legenda pod screenem | `src/renderer/html-builder.js` | PLANNED |
| T7 | Tool registry | `src/mcp/tools/index.js` | PLANNED |
| T8 | i18n | `src/preview/i18n/en.json`, `pl.json` | PLANNED |
| T9 | Testy | `tests/storage/comments.test.js` (NEW), `tests/mcp/comment-tools.test.js` (NEW) | PLANNED |

## MCP Tools
- `mockup_add_comment(project_id, screen_id, element_id?, text, author)`
- `mockup_list_comments(project_id, screen_id, include_resolved?)`
- `mockup_resolve_comment(project_id, screen_id, comment_id)`

## Note: v1 scope
PNG render z pinami jest w v1. Piny to `<div>` overlaye. Jeśli implementacja PNG pinów okaże się zbyt skomplikowana — odroczyć do M22b, w v1 tylko editor.
