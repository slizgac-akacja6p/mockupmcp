# M1 — MVP Implementation Tasks

**Branch:** `feature/m1-mvp`
**Sprint:** Implementation
**Design doc:** `docs/plans/mvp-architecture.md`
**Implementation plan:** `docs/plans/2026-02-20-mockupmcp-mvp.md`

## Task Overview

| # | Task | Agent | Impl | Tests | Status | Wave |
|---|------|-------|------|-------|--------|------|
| T1 | Project scaffolding | dev | DONE | n/a | DONE | A |
| T2 | Storage layer | dev | DONE | 17/17 | DONE | A |
| T3 | Component renderers + CSS | dev | DONE | 48/48 | DONE | A |
| T4 | HTML builder | dev | DONE | 7/7 | DONE | B |
| T5 | Screenshot module | dev | DONE | E2E | DONE | B |
| T6 | MCP server + tool schemas | dev | DONE | n/a | DONE | B |
| T7 | Tool handlers (4 files) | senior-dev | DONE | 21/21 | DONE | C |
| T8 | Preview server | dev | DONE | E2E | DONE | C |
| T9 | Entry point + wiring | dev | DONE | E2E | DONE | D |
| T10 | Docker build + E2E test | senior-dev | DONE | ALL PASS | DONE | D |
| FIX | XSS + review fixes | senior-dev | DONE | +15 | DONE | review |

## Waves (parallelization)

```
Wave A (parallel):  T1, T2, T3
Wave B (parallel):  T4 (needs T3), T5 (needs T1), T6 (needs T1)
Wave C (parallel):  T7 (needs T2+T4+T5+T6), T8 (needs T2+T4)
Wave D (sequential): T9 (needs all), T10 (needs T9)
```

## Task Details

### T1: Project scaffolding
**Files:** package.json, .gitignore, .dockerignore, Dockerfile, docker-compose.yml, src/config.js
**DoD:** `npm install` succeeds, Docker builds (even if app doesn't start yet)
**Notes:** Use `puppeteer-core` not `puppeteer`. ESM (`"type": "module"`). Node.js built-in test runner.

### T2: Storage layer
**Files:** src/storage/project-store.js, src/storage/id-generator.js, tests/storage/project-store.test.js
**DoD:** All CRUD operations work: projects, screens, elements. Atomic writes (temp+rename). ID validation regex. Tests pass.
**Notes:** See architecture doc ADR-004. Per-project write mutex. Validate IDs: `^[a-z]+_[A-Za-z0-9_-]+$`

### T3: Component renderers + wireframe CSS
**Files:** src/renderer/components/{text,rectangle,button,input,image,icon,navbar,tabbar,card,list}.js, src/renderer/components/index.js, src/renderer/styles/wireframe.css, tests/renderer/components.test.js
**DoD:** All 10 components render valid HTML. Registry maps types correctly. CSS defines wireframe palette. Tests verify HTML output.
**Notes:** Each component: `render(props)` + `defaults()`. Icon component needs ~20 Lucide SVG paths inlined. Navbar/tabbar use icon internally.

### T4: HTML builder
**Files:** src/renderer/html-builder.js, tests/renderer/html-builder.test.js
**DoD:** `buildScreenHtml(screen)` returns complete HTML doc with inlined CSS, positioned elements, overflow:hidden. Tests pass.
**Depends on:** T3 (components)

### T5: Screenshot module
**Files:** src/renderer/screenshot.js
**DoD:** `takeScreenshot(html, width, height)` returns PNG buffer. Browser singleton with lazy init. Error recovery (re-init on crash).
**Depends on:** T1 (puppeteer-core in package.json)
**Notes:** Testable only inside Docker (needs Chromium). Unit test with mock possible.

### T6: MCP server + tool schemas
**Files:** src/mcp/server.js, src/mcp/tools/index.js
**DoD:** MCP server creates with stdio transport. Tool registry function wires dependencies. Zod schemas defined for all 13 tools.
**Depends on:** T1 (MCP SDK in package.json)

### T7: Tool handlers
**Files:** src/mcp/tools/project-tools.js, src/mcp/tools/screen-tools.js, src/mcp/tools/element-tools.js, src/mcp/tools/export-tools.js, tests/mcp/tools.integration.test.js
**DoD:** All 13 tools handle valid input, return proper MCP responses. Export returns file path + base64 image. Error responses for invalid IDs/types.
**Depends on:** T2 (storage), T4 (html-builder), T5 (screenshot), T6 (MCP server)

### T8: Preview server
**Files:** src/preview/server.js, src/preview/templates/preview-page.html
**DoD:** GET /preview/:projectId/:screenId renders screen HTML with auto-reload script. GET /api/lastmod/:projectId returns timestamp.
**Depends on:** T2 (storage), T4 (html-builder)

### T9: Entry point + wiring
**Files:** src/index.js
**DoD:** `node src/index.js` starts both MCP server (stdio) and preview server (port 3100). Clean shutdown on SIGTERM.
**Depends on:** T6, T7, T8

### T10: Docker build + E2E test
**Files:** (no new files — testing existing)
**DoD:** `docker build` succeeds, image < 500MB. `docker run -i` starts MCP server. Full flow test: create project -> add screen -> add elements -> export PNG. Preview URL accessible. Claude Code MCP config works.
**Depends on:** T9
