# M2a Design — Components + Styles

**Date:** 2026-02-20
**Status:** Approved
**Scope:** 25 new components, 2 new styles (material, ios), duplicate_screen tool

---

## TL;DR

M2a extends MockupMCP from 10 to 35 components, adds material and iOS styles alongside wireframe, and adds duplicate_screen tool. Architecture: CSS-per-style files (same HTML, different CSS), composite components reuse primitives via render() imports, style stored at project level with optional screen override. Split into 2 sprints: (1) style system + 19 simple components, (2) 6 composites + duplicate_screen.

---

## A. Style System

### Approach
3 separate CSS files: `wireframe.css`, `material.css`, `ios.css`. Components generate identical HTML — visual differences via CSS only.

### Style Storage
- `project.style` — default style for project (default: `"wireframe"`)
- `screen.style` — optional per-screen override (null = inherit from project)
- Resolution: `screen.style || project.style || 'wireframe'`
- Backward-compatible: missing `style` field = wireframe

### Style Registry (`src/renderer/styles/index.js`)
- Loads CSS files on demand, caches in memory
- `loadStyle(name) -> string` — returns CSS content
- `getAvailableStyles() -> string[]`

### Escape Hatch
html-builder passes `_style` to component props. 95% of components ignore it. For 2-3 components where CSS alone isn't enough (toggle, select, slider), the component can check `props._style` and return variant HTML.

### Style Characteristics

| Feature | wireframe | material | ios |
|---------|-----------|----------|-----|
| Colors | Greyscale (#333, #666, #DDD) | Blue primary (#1976D2) | System blue (#007AFF) |
| Border-radius | 4px | 4-12px (M3 shapes) | 8-12px |
| Shadows | None | Elevation box-shadows | Subtle single-level |
| Font | System stack | Roboto (fallback system) | SF Pro (fallback system) |
| Buttons | Flat bordered | Filled/Tonal/Outlined M3 | Rounded pill |
| Inputs | Simple border | Outlined/Filled M3 | Rounded inset grey bg |
| Cards | 1px border | Elevated or outlined | Grouped inset |

**Note:** SF Pro font is Apple proprietary — cannot be bundled in Docker image. Falls back to system font stack.

### Files

| File | Change |
|------|--------|
| `src/renderer/styles/index.js` | **NEW** — style registry |
| `src/renderer/styles/material.css` | **NEW** |
| `src/renderer/styles/ios.css` | **NEW** |
| `src/renderer/styles/wireframe.css` | EXTEND with classes for 25 new components |
| `src/renderer/html-builder.js` | Accept `style` param, load CSS dynamically, pass `_style` to components |
| `src/mcp/tools/export-tools.js` | Pass style to buildScreenHtml |
| `src/mcp/tools/project-tools.js` | Add `style` param to create_project |
| `src/mcp/tools/screen-tools.js` | Add `style` param to add_screen |
| `src/preview/server.js` | Pass style to buildScreenHtml |

---

## B. New Components

### Pattern
Same as M1: `render(props) -> HTML string` + `defaults() -> default props`. Pure functions, all user content via `escapeHtml()`.

### Simple Components (19)

| Category | Components |
|----------|-----------|
| Basic | circle, line |
| Forms | textarea, checkbox, radio, toggle, select, slider |
| Navigation | sidebar, breadcrumb |
| Data | table, avatar, badge, chip |
| Feedback | alert, modal, skeleton, progress, tooltip |

### Composite Components (6)

| Component | Composes |
|-----------|---------|
| login_form | input, button |
| search_bar | input, icon |
| header | icon, button |
| footer | text |
| data_table | table internals + sort/filter UI |
| chart_placeholder | rectangle + text |

**Approach (hybrid):** Composites import `render()` from primitives for inner elements, but own their layout HTML (flexbox/block flow). Existing pattern — navbar.js already imports icon.render().

**Constraint:** Composites are "take it or leave it" blocks. Users can't reorder fields inside login_form — they use element primitives for custom layouts.

### Component Registry
Explicit imports in `src/renderer/components/index.js`, grouped logically. No auto-scan (YAGNI at 35 components).

### Responsive/Flexible Components
Components use `width:100%; height:100%` inside their bounding box. html-builder provides `position:absolute` + `overflow:hidden`. No changes needed.

---

## C. Schema Changes

### Project JSON

```json
{
  "id": "proj_abc123",
  "name": "App",
  "style": "material",
  "screens": [{
    "id": "scr_001",
    "style": null,
    "elements": [...]
  }]
}
```

### MCP Tool Changes

| Tool | Change |
|------|--------|
| `mockup_create_project` | Add `style` param (enum, default: wireframe) |
| `mockup_add_screen` | Add optional `style` param |
| `mockup_add_element` | Update type description string with all 35 types |
| `mockup_duplicate_screen` | **NEW** tool |

---

## D. duplicate_screen Tool

- `mockup_duplicate_screen(project_id, screen_id, new_name?)`
- `structuredClone()` source screen + regenerate all IDs (screen + elements)
- New method `ProjectStore.duplicateScreen()`

---

## E. Sprint Plan

### Sprint 1: Style System + Simple Components
- Style registry + 3 CSS files
- 19 simple components
- Component registry update
- html-builder + export + storage + MCP tool schema changes
- Tests for all

### Sprint 2: Composites + duplicate_screen
- 6 composite components
- duplicate_screen tool + storage method
- Integration tests across all 3 styles
- Final regression

### Estimation
~45 files, ~2860 LOC total (including tests).
